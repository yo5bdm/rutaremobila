/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package main;

import java.awt.Color;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.geom.Ellipse2D;
import java.awt.geom.Line2D;
import java.io.File;
import java.io.IOException;
import java.nio.charset.Charset;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.Timer;
import javax.swing.filechooser.FileNameExtensionFilter;

/**
 *
 * @author yo5bdm
 */
public class MainFrame extends javax.swing.JFrame {
    public static MainFrame m;
    public static ModelTabel model;
    //folosit la accestul individului best din firele de executie
    public static final Object O = new Object(); //syncronized
    public static Setari s; //setarile aplicatiei
    public static AlgoritmMutatie mut; //firul cu algoritm de mutatie, aici nu exista viata, insereaza firelele celelalte indivizii buni
    public static int[] procente;
    
//privati
    private Testing t = new Testing();
    private Timer paint;
    //pentru desenare
    private Camion camion;
    private double dx, dy;
    private double cenX, cenY;
    private int mX, mY;
    private double factorScalare;
    //runtime
    private boolean ruleaza=false;
    private ArrayList<AlgoritmGenetic> listaFire;
    
    private final int[] viataIndivid = new int[] {10,20,30,40,50,60,70};
    private final int[] intProbMutatii = new int[] {0,0,0,0,0,0,0}; //valorile folosite ca probabilitati de mutatie
    Timer timer = new Timer(50, new ActionListener() { // 50ms, adica vreo 20fps
        @Override
        public void actionPerformed(ActionEvent e) {
            m.repaint(); //main frame repaint
        }
    });

    /**
     * Creates new form MainFrame
     */
    public MainFrame() {
        this.cenY = -1.0;
        this.cenX = -1.0;
        //setLocationRelativeTo(null); //center
        initComponents();
        s = new Setari(this,true);
        m = this;
        model = new ModelTabel();
        setBest(null,"");
        jTable1.setModel(model);
        camion = null;
        PornesteGenerarea.setEnabled(false);
        SalveazaSolutia.setEnabled(false);
        VitezaAlgoritm.setEnabled(false);
        timer.start();
    }
    
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        Panel1 = new javax.swing.JPanel() {
            @Override
            public void paintComponent(Graphics g) {
                super.paintComponent(g);
                Graphics2D g2 = (Graphics2D)g;
                deseneaza(g2);
            }
        };
        jSlider1 = new javax.swing.JSlider();
        jPanel1 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();
        PornesteGenerarea = new javax.swing.JButton();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        BSDistanta = new javax.swing.JLabel();
        BSNrCamioane = new javax.swing.JLabel();
        BSGeneratia = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        VitezaAlgoritm = new javax.swing.JComboBox<>();
        Progres = new javax.swing.JProgressBar();
        SalveazaSolutia = new javax.swing.JButton();
        ButonSetari = new javax.swing.JButton();
        IncarcaCSV = new javax.swing.JButton();
        FisierIncarcat = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Rutare pachete");
        setLocation(new java.awt.Point(0, 0));
        setLocationByPlatform(true);

        Panel1.setBackground(new java.awt.Color(255, 255, 255));
        Panel1.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        Panel1.addMouseMotionListener(new java.awt.event.MouseMotionAdapter() {
            public void mouseDragged(java.awt.event.MouseEvent evt) {
                Panel1MouseDragged(evt);
            }
        });
        Panel1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mousePressed(java.awt.event.MouseEvent evt) {
                Panel1MousePressed(evt);
            }
        });

        javax.swing.GroupLayout Panel1Layout = new javax.swing.GroupLayout(Panel1);
        Panel1.setLayout(Panel1Layout);
        Panel1Layout.setHorizontalGroup(
            Panel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
        );
        Panel1Layout.setVerticalGroup(
            Panel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
        );

        jSlider1.setMaximum(300);
        jSlider1.setMinimum(1);

        jPanel1.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        jTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jTable1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTable1MouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(jTable1);

        PornesteGenerarea.setText("Porneste generarea");
        PornesteGenerarea.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                PornesteGenerareaActionPerformed(evt);
            }
        });

        jLabel3.setText("Cea mai buna solutie:");

        jLabel4.setText("Distanta totala:");

        jLabel5.setText("Nr Camioane folosite:");

        BSDistanta.setText("jLabel6");

        BSNrCamioane.setText("jLabel6");

        BSGeneratia.setText("jLabel6");

        jLabel6.setText("Tip generare:");

        VitezaAlgoritm.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Rapid", "Mediu", "Lent", "Infinit" }));
        VitezaAlgoritm.setSelectedIndex(2);
        VitezaAlgoritm.setToolTipText("<htmll>Selecteaza modul de lucru al algoritmului.<br>\nRapid - algoritmul merge o perioada scurta de timp inainte sa se opreasca (500 de pasi)<br>\nMediu - algoritmul functioneaza o perioada medie de timp (2000 de pasi)<br>\nLent - algoritmul functioneaza o perioada lunga de timp (10.000 de pasi)<br>\nInfinit - algoritmul functioneaza o perioada extrem de lunga de timp. Ideal daca doriti sa lasati calculatorul pornit o perioada lunga de timp</html>");

        SalveazaSolutia.setText("Salveaza solutia");
        SalveazaSolutia.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                SalveazaSolutiaActionPerformed(evt);
            }
        });

        ButonSetari.setText("Setari");
        ButonSetari.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ButonSetariActionPerformed(evt);
            }
        });

        IncarcaCSV.setText("Incarca fisier CSV");
        IncarcaCSV.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                IncarcaCSVActionPerformed(evt);
            }
        });

        FisierIncarcat.setText("Nici un fisier incarcat.");

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
                    .addComponent(Progres, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel3)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(BSGeneratia))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel4)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(BSDistanta))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel5)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(BSNrCamioane))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(SalveazaSolutia, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(ButonSetari))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(IncarcaCSV)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(FisierIncarcat)
                        .addGap(0, 35, Short.MAX_VALUE))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel6)
                            .addComponent(VitezaAlgoritm, javax.swing.GroupLayout.PREFERRED_SIZE, 85, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(PornesteGenerarea, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(IncarcaCSV)
                    .addComponent(FisierIncarcat))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel6)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(VitezaAlgoritm, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(PornesteGenerarea, javax.swing.GroupLayout.PREFERRED_SIZE, 49, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(Progres, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(BSGeneratia))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(BSDistanta))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(BSNrCamioane))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 440, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(SalveazaSolutia, javax.swing.GroupLayout.DEFAULT_SIZE, 38, Short.MAX_VALUE)
                    .addComponent(ButonSetari, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );

        jLabel1.setText("Zoom harta");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jSlider1, javax.swing.GroupLayout.DEFAULT_SIZE, 1049, Short.MAX_VALUE))
                    .addComponent(Panel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(Panel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jSlider1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel1)))
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void PornesteGenerareaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_PornesteGenerareaActionPerformed
        if(!ruleaza) {
            new Thread(){
                public void run() {
                    IncarcaCSV.setEnabled(false);
                    ButonSetari.setEnabled(false);
                    VitezaAlgoritm.setEnabled(false);
                    CamionDisponibil.adaugaCapacitate(101,10);
                    CamionDisponibil.adaugaCapacitate(91,15);
                    CamionDisponibil.adaugaCapacitate(81,9999);
                    //t.run(); //testele
                    Client.restore();
                    Client.calculeazaTablouDistante();
                    Client.rezolvaCeleMari();
                    int viteza = VitezaAlgoritm.getSelectedIndex();
                    listaFire = new ArrayList();
                    procente = new int[intProbMutatii.length+1];
                    AlgoritmGenetic a;
                    for(int i=0;i<=(intProbMutatii.length-1);i++) { //probabilitatea de mutatie intre 2 si 7
                        a = new AlgoritmGenetic(i,viteza,intProbMutatii[i],viataIndivid[i],s.memorie);
                        a.setPriority(s.prioritate);
                        a.start();
                        listaFire.add(a);
                    }
                    mut = new AlgoritmMutatie(intProbMutatii.length,viteza,20); //algoritm bazat doar pe mutatie
                    mut.start();
                    listaFire.add(mut);
                    PornesteGenerarea.setText("Opreste generarea");
                    ruleaza = true;
                    for(Thread t:listaFire) {
                        try {
                            t.join();
                        } catch (InterruptedException ex) {
                            Logger.getLogger(MainFrame.class.getName()).log(Level.SEVERE, null, ex);
                        }
                    }
                    IncarcaCSV.setEnabled(true);
                    ButonSetari.setEnabled(true);
                    VitezaAlgoritm.setEnabled(true);
                    PornesteGenerarea.setText("Porneste generarea");
                    ruleaza = false;
                }
            }.start();
            
        } else  {
            try {
                for(AlgoritmGenetic a:listaFire) {
                    a.opreste();
                    a.join();
                }
                IncarcaCSV.setEnabled(true);
                ButonSetari.setEnabled(true);
                VitezaAlgoritm.setEnabled(true);
                PornesteGenerarea.setText("Porneste generarea");
                ruleaza = false;
            } catch (InterruptedException ex) {
                Logger.getLogger(MainFrame.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }//GEN-LAST:event_PornesteGenerareaActionPerformed

    private void jTable1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTable1MouseClicked
        int[] selection = jTable1.getSelectedRows();
        ArrayList<String> listaCnp = new ArrayList();
        selection[0] = jTable1.convertRowIndexToModel(selection[0]);
        //luam in seama doar primul selectat
        camion = Individ.best.camioane.get(selection[0]);
    }//GEN-LAST:event_jTable1MouseClicked

    private void SalveazaSolutiaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_SalveazaSolutiaActionPerformed
        JFileChooser fileChooser = new JFileChooser(); //File curDir = din setari
        FileNameExtensionFilter filter = new FileNameExtensionFilter("Text File","txt");
        fileChooser.setFileFilter(filter);
        if (fileChooser.showSaveDialog(this) == JFileChooser.APPROVE_OPTION) {
            try {
                File file = fileChooser.getSelectedFile();
                List<String> lines = Fisier.genereazaFisier(Individ.best);//Arrays.asList("The first line", "The second line");
                Path f = Paths.get(file.getAbsolutePath());
                Files.write(f, lines, Charset.forName("UTF-8"));
            } catch (IOException ex) {
                Logger.getLogger(MainFrame.class.getName()).log(Level.SEVERE, null, ex);
            }
        }        
    }//GEN-LAST:event_SalveazaSolutiaActionPerformed

    private void IncarcaCSVActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_IncarcaCSVActionPerformed
        if(Fisier.incarcaClienti("clienti.csv")) {
            if(Client.clienti.size()>0) {
                PornesteGenerarea.setEnabled(true);
                SalveazaSolutia.setEnabled(false);
                VitezaAlgoritm.setEnabled(true);
                for(Client c:Client.clienti) { 
                    dx += (c.longitudine);
                    dy += (c.latitudine);
                }
                dx /= Client.clienti.size();
                dy /= Client.clienti.size();
            } else {
                PornesteGenerarea.setEnabled(false);
                SalveazaSolutia.setEnabled(false);
                VitezaAlgoritm.setEnabled(false);
            }
            FisierIncarcat.setText("Nr clienti = "+Client.clienti.size());
        }
    }//GEN-LAST:event_IncarcaCSVActionPerformed

    private void ButonSetariActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ButonSetariActionPerformed
        s.setVisible(true);
    }//GEN-LAST:event_ButonSetariActionPerformed

    private void Panel1MousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_Panel1MousePressed
        //salvam coordonatele mouseului
        mX = evt.getX();
        mY = evt.getY();
    }//GEN-LAST:event_Panel1MousePressed

    private void Panel1MouseDragged(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_Panel1MouseDragged
        //modificam centrul
        cenX += (double)(evt.getX()-mX);
        cenY += (double)(evt.getY()-mY);
        //salvam noile coordonate ale mouse-ului
        mX = evt.getX();
        mY = evt.getY();
    }//GEN-LAST:event_Panel1MouseDragged
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException | InstantiationException | IllegalAccessException | javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(MainFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        
        //</editor-fold>
        
        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new MainFrame().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel BSDistanta;
    private javax.swing.JLabel BSGeneratia;
    private javax.swing.JLabel BSNrCamioane;
    private javax.swing.JButton ButonSetari;
    private javax.swing.JLabel FisierIncarcat;
    private javax.swing.JButton IncarcaCSV;
    private javax.swing.JPanel Panel1;
    private javax.swing.JButton PornesteGenerarea;
    private javax.swing.JProgressBar Progres;
    private javax.swing.JButton SalveazaSolutia;
    private javax.swing.JComboBox<String> VitezaAlgoritm;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JSlider jSlider1;
    private javax.swing.JTable jTable1;
    // End of variables declaration//GEN-END:variables

    /**
     * Initializeaza ProgressBar-ul de pe pagina principala.
     * @param max Numarul maxim de generatii ce vor fi completate
     */
    public void initProgres(int max) {
        Progres.setMaximum(max);
        Progres.setValue(0);
        Progres.setStringPainted(true);
    }
    /**
     * Seteaza valoarea curenta a progresului pe ProgressBar-ul de pe pagina principala.
     * @param val Valoarea curenta a progresului
     */
    public void setProgres(int index, int val) {
        procente[index] = val;
        int media=0;
        for(int i:procente) media+=i;
        media/=procente.length;
        Progres.setValue(media);
        if(media%10==0) System.out.println(Arrays.toString(procente));
    }
    /**
     * Seteaza cea mai buna solutie din firul de executie, pentru afisare.
     * @param i individul ce urmeaza sa fie setat ca solutie noua cea mai buna
     * @param text String cu textul ce urmeaza sa fie afisat, cod de debugging
     */
    public void setBest(Individ i, String text) {
        if(i!=null) {
            int delta = Integer.MAX_VALUE;
            if(Individ.best!=null) delta = (int)(Individ.best.getFitness()-i.getFitness());
            Individ.best = i;
            BSDistanta.setText((int)((double)Individ.best.getFitness()+Individ.celeMariDist)+" km (-"+delta+")");
            BSNrCamioane.setText((Individ.best.camioane.size()+Individ.celeMariNrCamioane)+"");
            BSGeneratia.setText("("+text+")");
            SalveazaSolutia.setEnabled(true);
        } else {
            Individ.best = null;
            BSDistanta.setText("");
            BSNrCamioane.setText("");
            BSGeneratia.setText("");
            SalveazaSolutia.setEnabled(false);
        }
        model.fireTableDataChanged();
    }
    /**
     * Metoda de redesenare a jPanel-ului de pe MainFrame.
     * @param g Graphics2D trimis de catre jPanel.repaint()
     */
    public void deseneaza(Graphics2D g)  {
        
        factorScalare = (double)jSlider1.getValue();
        double max_x = Panel1.getWidth();
        double max_y = Panel1.getHeight();
        if(cenX==-1 || cenY ==-1) {
            cenX = max_x/2;
            cenY = max_y/2;
        }
        //deseneaza casa;
        g.setColor(Color.blue);
        g.draw(new Ellipse2D.Double((cenX + ((Client.casa.longitudine-dx)*factorScalare))-3, (cenY - ((Client.casa.latitudine-dy)*factorScalare))-3,6,6)); 
        //deseneaza restul clientilor
        g.setColor(Color.black);
        double x, y, x2,y2;
        for(Client c:Client.clienti) {
            x = cenX + ((c.longitudine-dx)*factorScalare); 
            y = cenY - ((c.latitudine-dy)*factorScalare);
            //g.drawOval((int)(x-1.5),(int)(y-1.5), 3, 3);
            g.draw(new Ellipse2D.Double(x-1.5, y-1.5,3,3));
        }
        // partea de desenare drumuri pt camionul selectat
        if(camion!=null) {
            //linia de acasa pana la primul:
            g.setColor(Color.BLUE);
            x = cenX + ((Client.casa.longitudine-dx)*factorScalare); 
            y = cenY - ((Client.casa.latitudine-dy)*factorScalare);
            x2 = cenX + ((Client.clienti.get(camion.solutia.get(0)).longitudine-dx)*factorScalare); 
            y2 = cenY - ((Client.clienti.get(camion.solutia.get(0)).latitudine-dy)*factorScalare);
            g.draw(new Line2D.Double(x, y, x2, y2));
            g.setColor(Color.black);
            for(int i=0;i<camion.solutia.size()-1;i++) {
                int i1 = camion.solutia.get(i);
                int i2 = camion.solutia.get(i+1);
                x = cenX + ((Client.clienti.get(i1).longitudine-dx)*factorScalare); 
                y = cenY - ((Client.clienti.get(i1).latitudine-dy)*factorScalare);
                x2 = cenX + ((Client.clienti.get(i2).longitudine-dx)*factorScalare); 
                y2 = cenY - ((Client.clienti.get(i2).latitudine-dy)*factorScalare);
                g.draw(new Line2D.Double(x, y, x2, y2));
            }
        }
    }
    /**
     * Afisare mesaj eroare.
     * Metoda statica pentru afisare mesaj de eroare de oriunde
     * @param msg String cu mesajul dorit
     */
    public static void mesajEroare(String msg) {
        JOptionPane.showMessageDialog(null, msg, "Eroare!", JOptionPane.ERROR_MESSAGE);
    }
    /**
     * Afisare mesaj de atentionare.
     * Metoda statica pentru afisare mesaj de atentionare
     * @param msg String cu mesajul dorit
     */
    public static void mesajAtentie(String msg) {
        JOptionPane.showMessageDialog(null, msg, "Atentie!", JOptionPane.WARNING_MESSAGE);
    }
}
